<!DOCTYPE html>
<html lang="en">
<head>
    <title></title>
    <script type="text/javascript" src="https://miro.com/app/static/sdk.1.1.js"></script>
</head>

<style>
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
    }

    #container {
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        display: flex;
        flex-wrap: wrap;
        flex-direction: row;
        align-items: center;
        padding-top: 32px;
        box-sizing: border-box;
    }

    .row {
        display: flex;
        flex-direction: row;
        padding-left: 32px;
        margin-bottom: 32px;
    }

    .draggable-item {
        margin-left: 32px;
        margin-bottom: 32px;
        width: 112px;
        height: 112px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff;
        font-size: 18px;
        font-family: sans-serif;
    }

    .draggable-item.red {
        background-color: #f24726;
    }

    .draggable-item.green {
        background-color: #0ca788;
    }

    .image-box img {
        max-width: 112px;
        max-height: 112px;
        cursor: pointer;
    }

</style>
<body>
<div id="container">
</div>
<script>


	function addShapes(container) {
		container.innerHTML += '<div class="shape draggable-item green" data-color="0ca788">I am shape</div>' +
			'<div class="draggable-item" data-color="0ca788"><svg height="151" width="172"><polygon points="164, 143, 8, 143, 86, 8" style="fill:white;stroke:black;stroke-width:8"/><text x="50%" y="64%" dominant-baseline="middle" text-anchor="middle" fill="black" font-size="2em">4</text></svg></div>'
	}


	function createShape(canvasX, canvasY, color, text) {
		return miro.board.widgets.create({
			type: 'shape',
			text: text,
			x: canvasX,
			y: canvasY,
			style: {
				textColor: '#fff',
				backgroundColor: '#' + color,
				borderColor: 'transparent'
			}
		})
	}

	function bootstrap() {
		const container = document.getElementById('container')
		addShapes(container)

        let currentImageUrl
	
		let currentShapeColor
		let currentShapeText
		const shapeOptions = {
			draggableItemSelector: '.shape',
			onClick: async (targetElement) => {
				const color = targetElement.getAttribute('data-color')
				const text = targetElement.innerText
				const widget = (await createShape(0, 0, color, text))[0]
				miro.board.viewport.zoomToObject(widget)

			},
			getDraggableItemPreview: (targetElement) => {
				currentShapeColor = targetElement.getAttribute('data-color')
				currentShapeText = targetElement.innerText
				return {
					url: `data:image/svg+xml,%3Csvg width='140' height='140' xmlns='http://www.w3.org/2000/svg'%3E%3Cg%3E%3Crect stroke='null' x='0' y='0' fill='%23${currentShapeColor}' height='140' width='140'/%3E%3C/g%3E%3C/svg%3E`
				}
			},
			onDrop: (canvasX, canvasY) => {
				console.log('onDrop 2')
				createShape(canvasX, canvasY, currentShapeColor, currentShapeText)
			}
		}
		miro.board.ui.initDraggableItemsContainer(container, shapeOptions)
	}

	miro.onReady(bootstrap)
</script>
</body>
</html>